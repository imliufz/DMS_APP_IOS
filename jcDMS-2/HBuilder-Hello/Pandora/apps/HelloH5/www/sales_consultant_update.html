<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="js/html_head.js"></script>
<title>顾问管理</title>
</head>
<body onLoad="_loadData();" onselectstart="return true;" ondragstart="return false;">
	<script type="text/javascript" src="js/detail_head.js?_menu_name=顾问管理&_is_loading=1" id="detail_head_js"></script>
	<form method="post" id="fm">
		<div class="masklayer" ontouchmove="return true;" onClick="$(this).toggleClass('on');">
			<script>
				var isAndroid = navigator.userAgent.toLowerCase().indexOf("android");
				document.write(isAndroid > -1 ? "<img src='static/img/instruction_android.png' alt='' style='width: auto!important;'>"
								: "<img src='static/img/instruction_iphone.png' alt='' style='width: auto!important;'>");
			</script>
		</div>

		<div class="cardexplain">
			<!--普通用户登录时显示-->
			<ul class="round">
				<form action="javascript:;" method="post">
					<li class="title mb">
						<span class="none">基本信息</span>
					</li>
					<li class="nob">
						<input name="formhash" id="formhash" value="2be3071a" type="hidden">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">姓名</td>
								<td width="36%">
									<input name="NAME" class="px" id="NAME" placeholder="请输入姓名" type="text"  readonly="readonly">
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">手机号码</td>
								<td width="36%">
									<input name="TEL" class="px" id="TEL" placeholder="请输入手机号码" type="tel"   readonly="readonly">
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">在岗状态<font color="red">*</font></td>
								<td width="36%">
									<select name="WORKING_STATE" id="WORKING_STATE" class="download dropdown-select" required="required">
									</select>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">顾问标签<font color="red">*</font></td>
								<td width="36%" id="tagContent">
								</td>
							</tr>
						</table>
					</li>
					<div class="footReturn">
						<input type="hidden" name="ID" id="ID" />
						<input id="submitBtn" class="submit" value="提   交" type="button" style="width: 100%" onClick="submitForm();">
						<br /> <br /> <br /> <br />
						<div class="window" id="windowcenter">
							<div id="title" class="wtitle">
								操作提示<span class="close" id="alertclose"></span>
							</div>
							<div class="content">
								<div id="txt"></div>
							</div>
						</div>
					</div>
				</form>
	</form>
</body>
<script type="text/javascript">
	function _loadData() {
		var id = UrlParm.parm("id");
		var url = httpUrlHead + "SalesConsultantService/loadSalesConsultantInfo.json?id=" + id + "&" + httpUrlEnd;
		makeFormCall(
			url,
			function(json) {
				if (json.RESULT.maps != null && json.RESULT.maps.length > 0) {
					var map = json.RESULT.maps[0];
					document.getElementById("ID").value = map.ID;
					document.getElementById("NAME").value = map.NAME;
					document.getElementById("TEL").value = map.TEL;
					document.getElementById("WORKING_STATE").setAttribute("defaultValue", map.WORKING_STATE);
					
					//加载tc_code
					_loadTcCode("7016", "WORKING_STATE");
				}
				if(json.allTagList != null && json.allTagList.length > 0 ){
    				var appendHtml = "";
    				for(var i=0;i<json.allTagList.length;i++){
    					appendHtml += '<div class="mui-input-row mui-checkbox mui-left" style="float: left;clear:none">';
    					appendHtml += '<label>'+json.allTagList[i].CODE_DESC+'</label>';
    					appendHtml += '<input id="'+json.allTagList[i].CODE_ID+'" name="consultantTag" value="'+json.allTagList[i].CODE_ID+'" type="checkbox" ></div>';
    				}
    				$("#tagContent").html(appendHtml);
    			}
	    		if(json.tagList != null && json.tagList.length > 0 ){
	    			for(var i=0;i<json.tagList.length;i++){
	    				$("#"+json.tagList[i].TAG_TYPE).attr("checked",true);
	    			}
				}
			}, "fm", false,true);
	}
    
    function submitForm() {
    	if ($("#WORKING_STATE").val() == ""){
    		MuiAlert("在岗状态必填");
    		return false;
    	}
    	if($("input[name='consultantTag']:checked").length == 0 ){
			MuiAlert("至少选择一个标签");
			return false;
		}
    		MuiConfirm("确定提交吗?",function(e){
	    		if(e.index == 0 ){
	    			var url = httpUrlHead + "SalesConsultantService/updateSalesConsultant.json?" + httpUrlEnd;
			makeFormCall(
					url,
					function(json) {
						if (json.RESULT.funcStatus == '1') {
							MuiAlert("提交成功！",toGoBack());
						} else {
							MuiAlert("提交失败，请联系系统管理员！");
						}
					}, "fm", true);
	    		}
    		});
    }

	function toGoBack() {
		ToUrl("sales_consultant_list.html",2);
	}
</script>
</html>