<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="js/html_head.js"></script>
<title>顾问管理</title>
</head>
<body onselectstart="return true;" ondragstart="return false;">
	<script type="text/javascript" src="js/detail_head.js?_menu_name=顾问管理" id="detail_head_js"></script>
	<form method="post" id="fm">
		<div class="masklayer" ontouchmove="return true;" onClick="$(this).toggleClass('on');">
			<script>
				var isAndroid = navigator.userAgent.toLowerCase().indexOf("android");
				document.write(isAndroid > -1 ? "<img src='static/img/instruction_android.png' alt='' style='width: auto!important;'>"
								: "<img src='static/img/instruction_iphone.png' alt='' style='width: auto!important;'>");
			</script>
		</div>

		<div class="cardexplain">
			<!--普通用户登录时显示-->
			<ul class="round">
				<form action="javascript:;" method="post">
					<li class="title mb">
						<span class="none">基本信息</span>
					</li>
					<li class="nob">
						<input name="formhash" id="formhash" value="2be3071a" type="hidden">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">姓名<font color="red">*</font></td>
								<td width="36%">
									<input name="NAME" class="px" id="NAME" placeholder="请输入姓名" type="text" required="required">
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">性别<font color="red">*</font></td>
								<td width="36%">
									<select name="SEX" id="SEX" class="download dropdown-select" required="required">
										<option value="">-请选择-</option>
									</select>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">身份证号<font color="red">*</font></td>
								<td width="36%">
									<input id="IDENTITY_NUMBER" name="IDENTITY_NUMBER" class="px" placeholder="请输入身份证号" type="text" required="required" pattern="^[1-9]{1}[0-9]{14}$|^[1-9]{1}[0-9]{16}([0-9]|[xX])$" onblur="setBornYear(this.value);">
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">手机号码<font color="red">*</font></td>
								<td width="36%">
									<input name="TEL" class="px" id="TEL" placeholder="请输入手机号码" type="tel" required="required">
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">登录密码<font color="red">*</font></td>
								<td width="36%">
									<input name="PWD" class="px" id="PWD" placeholder="请输入登录密码" type="password" required="required">
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">学历<font color="red">*</font></td>
								<td width="36%">
									<select name="ACADEMIC_RECORDS" id="ACADEMIC_RECORDS" class="download dropdown-select" required="required">
										<option value="">-请选择-</option>
									</select>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">顾问类型<font color="red">*</font></td>
								<td width="36%">
									<select name="SALES_ADVISOR_TYPE" id="SALES_ADVISOR_TYPE" class="download dropdown-select" required="required">
										<option value="">-请选择-</option>
									</select>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">出生日期<font color="red">*</font></td>
								<td width="36%">
									<input name="BORN_YEAR" id="BORN_YEAR" type="date" class="px" placeholder="出生日期" required="required" />
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">从事汽车行业日期<font color="red">*</font></td>
								<td width="36%">
									<input name="TRADE_YEAR" id="TRADE_YEAR" type="date" class="px" required="required" onblur="checkTradeYear(this.value);"/>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">从事长安汽车行业日期<font color="red">*</font></td>
								<td width="36%">
									<input name="CHANA_TRADE_YEAR" id="CHANA_TRADE_YEAR" type="date" class="px" required="required" onblur="checkChanaTradeYear(this.value);"/>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td width="64%">在岗状态<font color="red">*</font></td>
								<td width="36%">
									<select name="WORKING_STATE" id="WORKING_STATE" class="download dropdown-select" required="required"></select>
								</td>
							</tr>
						</table>
					</li>
					<li class="nob">
						<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr class="biaoge">
								<td>申请原因<font color="red">*</font></td>
								<td>
									<textarea name="REASON" class="pxtextarea" style="height: 99px; overflow-y: visible" id="REASON" placeholder="请输入申请原因" required="required"></textarea>
								</td>
							</tr>
						</table>
					</li>
					<div class="footReturn">
						<input type="hidden" name="ID" id="ID" />
						<input id="submitBtn" class="submit" value="提   交" type="submit" style="width: 100%" onClick="validateForm();">
						<br /> <br /> <br /> <br />
						<div class="window" id="windowcenter">
							<div id="title" class="wtitle">
								操作提示<span class="close" id="alertclose"></span>
							</div>
							<div class="content">
								<div id="txt"></div>
							</div>
						</div>
					</div>
				</form>
			</ul>
		</div>
	</form>
</body>
<script type="text/javascript">

	var changeFlag = false;
	
	$(document).ready(function() {
		
		$(":input").change(function(){
			changeFlag=true;     
		});
		
		$("select").change(function(){
			changeFlag=true;     
		});
		
		$("textarea").change(function(){
			changeFlag=true;     
		});
		
	});
	
	// 加载tc_code
	_loadTcCode("1003", "8057", "2101", "7016", "SEX", "ACADEMIC_RECORDS", "SALES_ADVISOR_TYPE", "WORKING_STATE");
	

	// 验证同一经销商顾问姓名不能重复
	function checkName(name) {
		if(name.trim() != '') {
			var url = httpUrlHead + "SalesConsultantService/checkName.json?" + httpUrlEnd + "&salesConName="+encodeURI(encodeURI(name));
			makeFormCall(url, function(json) {
				if(json.flag == false) {
					MuiAlert('本店此姓名的状态为已提报或审核通过的顾问信息已存在');
				}
			}, "fm");
		}
	}
	
	// 验证同一经销商顾问手机号码不能重复
	function checkMobilePhone(tel) {
		if(tel != '') {
			var url = httpUrlHead + "SalesConsultantService/checkMobilePhone.json?" + httpUrlEnd +"&tel=" + tel;
			makeFormCall(url, function(json) {
				if(json.flag == false) {
					MuiAlert('此手机号码的状态为已提报或审核通过的顾问信息已存在');
				}
			}, "fm");
		}
	}
	
	//表单验证
    function validateForm(){
    	if(!_validForm("IDENTITY_NUMBER", "身份证号格式不正确。", "^[1-9]{1}[0-9]{14}$|^[1-9]{1}[0-9]{16}([0-9]|[xX])$")) {return;}
    	if(!_validForm("TEL", "手机号码格式不正确。", "^1[3|5|7|8|][0-9]{9}$")) {return;}
    }
	
	$("#fm").html5Validate(function() {
		var url = httpUrlHead + "SalesConsultantService/checkName.json?" + httpUrlEnd + "&salesConName="+encodeURI(encodeURI(document.getElementById('NAME').value));
		makeFormCall(url, function(json) {
			if(json.flag == false) {
				MuiAlert('本店此姓名的状态为已提报或审核通过的顾问信息已存在');
			} else {
				url = httpUrlHead + "SalesConsultantService/checkMobilePhone.json?" + httpUrlEnd +"&tel=" + document.getElementById('TEL').value;
				makeFormCall(url, function(json) {
					if(json.flag == false) {
						MuiAlert('此手机号码的状态为已提报或审核通过的顾问信息已存在');
					} else {
						if(!checkTradeYear(document.getElementById('TRADE_YEAR').value)) {return;}
						if(!checkChanaTradeYear(document.getElementById('CHANA_TRADE_YEAR').value)) {return;}
						MuiConfirm("确定提交吗?”,function(e){
					    		if(e.index == 0 ){
					    			var url = httpUrlHead + "SalesConsultantService/addSalesConsultant.json?" + httpUrlEnd;
							makeFormCall(url, _submitCallBack, 'fm');
				    			}
    						});
					}
				}, "fm");
			}
		}, "fm");
	});

	function _submitCallBack(json) {
		if (json.RESULT.funcStatus == '1') {
			MuiAlert("提交成功！",toGoBack());
		} else {
			MuiAlert("提交失败，请联系系统管理员！");
		}
	}

	function toGoBack() {
		ToUrl("sales_consultant_list.html",2)
	}
	
	function setBornYear(val) {
		var pattern = new RegExp("^[1-9]{1}[0-9]{14}$|^[1-9]{1}[0-9]{16}([0-9]|[xX])$");
		if (pattern.exec(val)) {
			var bornDate = val.substring(6, 14);
			document.getElementById('BORN_YEAR').value = bornDate.substring(0, 4) + "-" + bornDate.substring(4, 6) + "-" + bornDate.substring(6, 8);
		}
	}

	function checkTradeYear(val) {
		var bornDate = document.getElementById('BORN_YEAR').value;
		if (bornDate != "" && val != "") {
			if (bornDate > val) {
				MuiAlert("从事汽车行业日期不能早于出生日期！");
				document.getElementById('TRADE_YEAR').value = "";
				return false;
			}
		}
		var chanaTradeYear = document.getElementById('CHANA_TRADE_YEAR').value;
		if (chanaTradeYear != "" && val != "") {
			if (chanaTradeYear < val) {
				MuiAlert("从事汽车行业日期必须早于从事长安汽车行业日期！");
				document.getElementById('TRADE_YEAR').value = "";
				return false;
			}
		}
		return true;
	}

	function checkChanaTradeYear(val) {
		var tradeYear = document.getElementById('TRADE_YEAR').value;
		if (tradeYear != "" && val != "") {
			if (tradeYear > val) {
				MuiAlert("从事长安汽车行业日期不能早于从事汽车行业日期！");
				document.getElementById('CHANA_TRADE_YEAR').value = "";
				return false;
			}
		}
		if (val != "") {
			var todayDate = new Date().getFullYear() + "-" + (new Date().getMonth() < 9 ? "0" : "") + (new Date().getMonth() + 1) + "-" + (new Date().getDate()<10?"0":"")+new Date().getDate();
			if (val > todayDate) {
				MuiAlert("从事长安汽车行业日期不能大于当前日期！");
				document.getElementById('CHANA_TRADE_YEAR').value = "";
				return false;
			}
		}
		return true;
	}
</script>
</html>