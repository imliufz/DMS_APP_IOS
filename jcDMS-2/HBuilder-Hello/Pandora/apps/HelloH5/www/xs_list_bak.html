<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="js/html_head.js"></script>

<title>线索查询</title>
</head>
<body onselectstart="return true;" ondragstart="return false;">
	<script type="text/javascript" src="js/detail_head.js?_menu_name=线索查询" id="detail_head_js"></script>
	<form id="fm" method="post">
		<input type="hidden" id="status" name="status" value="30331001,30331003,30331004,30331005"/>
		<input type="hidden" id="closeStatus" name="closeStatus" value="30401002,30401003,30401004"/>
		<div class="cardexplain">
			<ul class="round">
				<table id="tb_query">
					<tr class="biaoge">
						<td>姓名/手机</td>
						<td>
							<li class="nob">
								<input type="text" id="customerNamePhone" name="customerNamePhone" value="" placeholder="客户姓名/手机号码" class="px" />
							</li>
						</td>
					</tr>
					<tr class="biaoge" id="salesConsultantTr"  style="display: none;">
					<td>选择顾问 </td>
                 	<td>
	                    <li class="nob">
	                        <input type="text" id="salesConsultant_show" name="salesConsultant_show"  placeholder="选择顾问"  value="" class="px"  readonly="readonly"/>
	                        <input type="hidden" id="salesConsultant" name="salesConsultant" value="" />
	                        <input type="hidden" id="CUS_SOURCE01" name="CUS_SOURCE01" value="" />
	                        <input type="hidden" id="OEM_SOURCE01" name="OEM_SOURCE01" value="" />
	                        <input type="hidden" id="INTENT_LEVEL01" name="INTENT_LEVEL01" value="" />
	                        <input type="hidden" id="INTENT_SERIES01" name="INTENT_SERIES01" value="" />
	                        <input type="hidden" id="IS_STA01" name="IS_STA01" value="" />
	                        <input type="hidden" id="failDateBegin01" name="failDateBegin01" value="" />
	                        <input type="hidden" id="failDateEnd01" name="failDateEnd01" value="" />
	                        <input type="hidden" id="CLUE_SOURCE01" name="CLUE_SOURCE01" value="" />
	                        <input type="hidden" id="IS_JS01" name="IS_JS01" value="" />
	                        <input type="hidden" id="SALES_CONSULTANT01" name="SALES_CONSULTANT01" value="" />
	                        
	                    </li>	           
	               </td>
				</tr>
					<tr class="biaoge">
						<td>意向级别</td>
						<td>
							<li class="nob">
								<input type="text" id="intentLevel_show" name="intentLevel_show"  placeholder="意向级别"  value="" class="px"   readonly="readonly"/>
						 	 <input type="hidden" id="intentLevel" name="intentLevel" value="" />
							</li>
						</td>
					</tr>
					<tr class="biaoge">
                		<td>车系	</td>
                    <td>
						 <li class="nob">
                             <select id="INTENT_SERIES" name="INTENT_SERIES" class="download dropdown-select"   search="show" onchange="changeSMPCForLd(this.value)">
                                <option value="">-请选择-</option>
                            </select>
                            <input name="INTENT_SERIES_h" id="INTENT_SERIES_h" value=""  type="hidden"  />
                        </li>                    </td>
                </tr>
                <tr class="biaoge">
                	<td>车型	</td>
                    <td>
						 <li class="nob">
                             <select id="intentModel" name="intentModel" class="download dropdown-select"   search="show">
                                <option value="">-请选择-</option>
                            </select>
                            <input name="intentModel_h" id="intentModel_h" value=""  type="hidden"  />
                        </li>                    </td>
                </tr>
					<tr class="biaoge">
						<td>是否OEM下发</td>
						<td>
							<li class="nob">
								<select id="isOem" name="isOem" class="download dropdown-select">
									<option value="">-请选择-</option>
									<option value="10041001">是</option>
									<option value="10041002">否</option>
								</select>
							</li>
						</td>
					</tr>
					<tr class="biaoge" id="cusSource_Tr" style="display: none;">
						<td>客户来源</td>
						<td>
							<li class="nob">
								<select name="cusSource" id="cusSource" class="download dropdown-select"  search="show">
									<option value="">-请选择-</option>
								</select>
								<input name="cusSource_h" id="cusSource_h" value=""  type="hidden"  />
							</li>
						</td>
					</tr>
					<tr id="oemCusSource_Tr" style="display: none;">
						<td>OEM客户来源</td>
						<td>
							<li class="nob">
								<select id="oemCusSource" name="oemCusSource" class="download dropdown-select"  search="show">
									<option value="">-请选择-</option>
								</select>
								<input name="oemCusSource_h" id="oemCusSource_h" value=""  type="hidden"  />
							</li>
						</td>
					</tr>
					<tr class="biaoge">
						<td>活动代码/名称</td>
						<td>
							<li class="nob">
								<input type="text" id="campaignCodeName" name="campaignCodeName" placeholder="活动代码/名称" class="px" />
							</li>
						</td>
					</tr>
					<tr class="biaoge">
						<td>到店次数</td>
						<td>
							<li class="nob">
								<select name="arriveTimes" id="arriveTimes" class="download dropdown-select">
									<option value="">-请选择-</option>
									<option value="1">首次到店</option>
									<option value="2">二次到店</option>
								</select>
							</li>
						</td>
					</tr>
					<tr class="biaoge">
						<td>是否首次超期</td>
						<td>
							<li class="nob">
								<select name="isFirstCQ" id="isFirstCQ" class="download dropdown-select">
									<option value="">-请选择-</option>
									<option value="10041001">是</option>
									<option value="10041002">否</option>
								</select>
							</li>
						</td>
					</tr>
					<tr class="biaoge">
						<td>时间类型</td>
						<td>
							<li class="nob">
								<select name="dataType" id="dataType" class="download dropdown-select"  onchange="dateTypeChange(this.value)">
									<option value="">-请选择-</option>
									<option value="0">计划时间</option>
									<option value="1" selected="selected">创建时间</option>
									<option value="2">下发时间</option>
									<option value="3">执行时间</option>
									<option value="4">邀约到店时间</option>
								</select>
							</li>
						</td>
					</tr>
					<tr class="biaoge" name="dateTr">
						<td>开始日期</td>
						<td>
							<li class="nob">
								<input name="startDate" id="startDate" value="" type="date" class="px" placeholder="开始日期"  search="show"/>
								<input name="startDate_h" id="startDate_h" value=""  type="hidden"  />
							</li>
						</td>
					</tr>
					<tr class="biaoge" name="dateTr">
						<td>结束日期</td>
						<td>
							<li class="nob">
								<input name="endDate" id="endDate" value="" type="date" class="px" placeholder="结束日期"  search="show"/>
								<input name="endDate_h" id="endDate_h" value=""  type="hidden"  />
							</li>
						</td>
					</tr>
					<!-- 
					<tr class="biaoge">
						<td>跟进日期</td>
						<td>
							<li class="nob">
								<input name="actionDate" id="actionDate" value="" type="date" class="px" placeholder="跟进日期"   search="show" />
								<input name="actionDate_h" id="actionDate_h" value=""  type="hidden"  />
							</li>
						</td>
					</tr>
					 -->
					<tr>
						<td colspan="2" align="center" height="60">
							<li class="nob">
								<input id="queryBtn" value="查   询" type="button" class="submit" style="width: 90%" onClick="changeUrlQuery();">
							</li>
						</td>
					</tr>
				</table>
				<li class="shouqu" id="txt_query" onClick="_showQuery();">收起</li>
			</ul>
		</div>
		<div id="queryLevelHtml" style="display: none;">
		<table width="100%"  style="margin-top: 30%;">
            	<tr class="biaoge">
                    <td width="10%" align="center">H级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101001">
                     </td>
                     <td width="10%"  align="center">A级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101002">
                     </td>
                     <td width="10%"  align="center">B级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101003">
                     </td>
                </tr >
                <tr class="biaoge">
                    <td width="10%" align="center">C级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101004">
                     </td>
                     <td width="10%"  align="center">N级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101005">
                     </td>
                     <td width="10%"  align="center">F0级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101006">
                     </td>
                </tr >
                <tr class="biaoge">
                    <td width="10%" align="center">F级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101007">
                     </td>
                     <td width="10%"  align="center">O级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101008">
                     </td>
                     <td width="10%"  align="center">D级</td>
                    <td width="20%"  align="center">
                            <input type="checkbox" name="level"  style="width: 20px;height: 20px;vertical-align:middle;" value="13101009">
                     </td>
                </tr >
                <tr>
					<td colspan="6" align="center" height="60">
						<li class="nob">
							<input value="确认选择" type="button" class="submit" style="width: 90%" onclick="closeQueryLevel()">
						</li>
					</td>
				</tr>
          </table>
	</div>
		<div id="tabList"></div>
	</form>
	<div id="querySalesConsultantHtml"  style="display: none;">
		<table width="100%"  style="margin-top: 10%;">
                <tr>
					<td colspan="6" align="center" height="60">
						<li class="nob">
							<input value="确认选择" type="button" class="submit" style="width: 90%" onclick="closeQuerySalesConsultant()">
						</li>
					</td>
				</tr>
          </table>
	</div>
</body>
<script type="text/javascript">
	var url = httpUrlHead+"PotcusAchieveService/queryPotentialCustomerFollowList.json?"+httpUrlEnd;
	//加载意向车系
	_loadSeries("INTENT_SERIES");
	//加载tc_code salesConsultant(销售顾问)需放在第一个
	_loadTcCodeAndCallBack("1311","3031","cusSource","oemCusSource"); 

    function setDate(){
    	var nextDate = _addDate(new Date(), 0);
		document.getElementById('startDate').value = nextDate.getFullYear()+"-"+(nextDate.getMonth()<9?"0":"")+(nextDate.getMonth()+1)+"-"+(nextDate.getDate()<10?"0":"")+nextDate.getDate();
		document.getElementById('endDate').value = nextDate.getFullYear()+"-"+(nextDate.getMonth()<9?"0":"")+(nextDate.getMonth()+1)+"-"+(nextDate.getDate()<10?"0":"")+nextDate.getDate();
    }
    
    $(document).ready(function () {
       
        
        document.getElementById("CUS_SOURCE01").value = UrlParm.parm("CUS_SOURCE");
        document.getElementById("OEM_SOURCE01").value = UrlParm.parm("OEM_SOURCE01");
        document.getElementById("INTENT_LEVEL01").value = UrlParm.parm("INTENT_LEVEL");
        document.getElementById("INTENT_SERIES01").value = UrlParm.parm("INTENT_SERIES");
        document.getElementById("IS_STA01").value = UrlParm.parm("IS_STA");
        document.getElementById("failDateBegin01").value = UrlParm.parm("failDateBegin");
        document.getElementById("failDateEnd01").value = UrlParm.parm("failDateEnd");
        document.getElementById("CLUE_SOURCE01").value = UrlParm.parm("CLUE_SOURCE");
        document.getElementById("IS_JS01").value = UrlParm.parm("IS_JS");
        document.getElementById("SALES_CONSULTANT01").value = UrlParm.parm("SALES_CONSULTANT");
        var searchTxt = UrlParm.parm("search");
        var menuTypeReport = UrlParm.parm("menuType");
        if(IsNull(menuTypeReport))
        {
        	 setDate();
        }
    	$("#dataType").change(function() {
    		if($("#dataType").val() == '4') {
    			var nextDate = _addDate(new Date(), 0);
    			document.getElementById('startDate').value = nextDate.getFullYear()+"-"+(nextDate.getMonth()<9?"0":"")+(nextDate.getMonth()+1)+"-"+(nextDate.getDate()<10?"0":"")+nextDate.getDate();
    			document.getElementById('endDate').value = nextDate.getFullYear()+"-"+(nextDate.getMonth()<9?"0":"")+(nextDate.getMonth()+1)+"-"+(nextDate.getDate()<10?"0":"")+nextDate.getDate();
    		} else {
    			document.getElementById('startDate').value = new Date().getFullYear()+"-"+(new Date().getMonth()<9?"0":"")+(new Date().getMonth()+1)+"-"+(new Date().getDate()<10?"0":"")+new Date().getDate();
    			document.getElementById('endDate').value = new Date().getFullYear()+"-"+(new Date().getMonth()<9?"0":"")+(new Date().getMonth()+1)+"-"+(new Date().getDate()<10?"0":"")+new Date().getDate();
    		}
    	});
    	
    	var isOem = $("#isOem").val();
    	if(isOem == '10041001') {
    		$("#cusSource_Tr").hide();
    		$("#oemCusSource_Tr").show();
    	} else if(isOem == "10041002") {
    		$("#cusSource_Tr").show();
    		$("#oemCusSource_Tr").hide();
    	} else {
    		$("#cusSource_Tr").hide();
    		$("#oemCusSource_Tr").hide();
    	}
    	$("#isOem").change(function() {
    		if($("#isOem").val() == '10041001') {
    			$("#cusSource").val("");
    			$("#cusSource_Tr").hide();
        		$("#oemCusSource_Tr").show();
    		} else if($("#isOem").val() == "10041002") {
    			$("#oemCusSource").val("");
    			$("#cusSource_Tr").show();
        		$("#oemCusSource_Tr").hide();
    		} else {
    			$("#cusSource").val("");
    			$("#oemCusSource").val("");
    			$("#cusSource_Tr").hide();
        		$("#oemCusSource_Tr").hide();
    		}
    	});
    	var IS_MANAGER = getLocalStorage("IS_MANAGER");
    	if(IS_MANAGER == 10041001){//销售经理
		$('#salesConsultantTr').show();
		var logonUser = JSON.parse(getLocalStorage("logonUser"));
		var salesConsultant = logonUser.salesConsultant.split(",");
		if(salesConsultant != null && salesConsultant.length > 0) {
			var appendHtml = "";
			for(var i = 0;i < salesConsultant.length;i++) {
				var name = salesConsultant[i].replace(/\'/g,"");
				if(i%3 == 0){
					appendHtml += '<tr class="biaoge"><td width="20%" align="center">'+name+'</td><td width="10%"  align="center"><input type="checkbox" name="salesConsultantCB"  style="width: 20px;height: 20px;vertical-align:middle;" value="'+name+'"></td>';
				} else {
					appendHtml += '<td width="20%" align="center">'+name+'</td><td width="10%"  align="center"><input type="checkbox" name="salesConsultantCB"  style="width: 20px;height: 20px;vertical-align:middle;" value="'+name+'"></td>';
				}
			}
			$("#querySalesConsultantHtml").find("table").prepend(appendHtml);
		} else {
			MuiAlert("该分组下无销售顾问!");
		}
	}
    	$("#intentLevel_show").click(function(){
    		$("input[name='level']").attr("name","level_copy");
    		var queryLevelHtmlCopy = $("#queryLevelHtml").html();
    		$("input[name='level_copy']").attr("name","level");
    		var pageii = layer.open({
        	    type: 1,
        	    content: queryLevelHtmlCopy,
        	    style: 'position:fixed; left:0; top:0; width:100%; height:100%; border:none;'
        	});
    	});
    	$("#salesConsultant_show").click(function(){
    		$("input[name='salesConsultantCB']").attr("name","salesConsultantCB_copy");
    		var querySalesConsultantHtmlCopy = $("#querySalesConsultantHtml").html();
    		$("input[name='salesConsultantCB_copy']").attr("name","salesConsultantCB");
    		$('#fm').hide();
    		var pageii = layer.open({
        	    type: 1,
        	    content: querySalesConsultantHtmlCopy,
        	    style: 'position:fixed; left:0; top:0; width:100%; height:100%; border:none;overflow-y: scroll;'
        	});
    	});
    	var menuType = UrlParm.parm("menuType");
		$("#mainPage").click(function(){
			_mainPage(menuType);
		});
		
		if(searchTxt != undefined && searchTxt != "undefined" && searchTxt != ""){
			document.getElementById("dataType").value = "1";
			dateTypeChange("1");
			$("#startDate").val("");
			$("#endDate").val("");
			var validateLevel = ["H","A","B","C","N","FO","F0","F","O","D"];
			var validateLevelValue = ["13101001","13101002","13101003","13101004","13101005","13101006","13101006","13101007","13101008","13101009"];
			var validateLevelText = ["H级","A级","B级","C级","N级","FO级","FO级","F级","O级","D级"];
			var searchLevelText = "";
			var searchLevelValue = "";
			var searchTxts = searchTxt.split(",") > 1 ? searchTxt.split(",") : searchTxt.split("，");
			for(var i = 0; i < validateLevel.length;i++){
				for(var j = 0;j < searchTxts.length; j++){
					if(searchTxts[j].toUpperCase().indexOf(validateLevel[i]) >= 0){
						searchLevelText += validateLevelText[i]+",";
						searchLevelValue += validateLevelValue[i]+",";
						break;
					}
				}
			}
			if(searchLevelText != "" && searchLevelValue != ""){
				closeQueryLevel(searchLevelText,searchLevelValue);
			} else {
				document.getElementById("customerNamePhone").value = searchTxt;
				url = httpUrlHead+"PotcusAchieveService/queryPotcusIndexSearch.json?"+httpUrlEnd; 
			}
		}
    });
    
    function closeQueryLevel(setText,setValues) {
		var text = "";
		var values = "";
		if(!IsNull(setText) && !IsNull(setValues)) {
			text = setText;
			values = setValues;
		} else {
			$("input[name='level_copy']:checked").each(function(){
				text += $(this).parent().prev().text()+",";
				values += $(this).val()+",";
			});
		}
		if(text != ""){
			text = text.substring(0, text.length-1);
			values = values.substring(0, values.length-1);
		}
		$("#intentLevel_show").val(text);
		$("#intentLevel").val(values);
		layer.closeAll();
		var array = values.split(",");
		$("input[name='level']").attr("checked",false);
		for (var i=0 ; i< array.length ; i++){
			$("input[name='level']").each(function(){
				var value = $(this).val();
				if(value == array[i]){
					$(this).attr("checked",true);
				}
			});
		}
	}
	
	function closeQuerySalesConsultant() {
		$('#fm').show();
		var values = "";
		var queryValues = "";
		$("input[name='salesConsultantCB_copy']:checked").each(function(){
			values += $(this).val()+",";
			queryValues += "'"+$(this).val()+"',";
		});
		if(values != ""){
			values = values.substring(0, values.length-1);
			queryValues = queryValues.substring(0, queryValues.length-1);
		}
		$("#salesConsultant_show").val(values);
		$("#salesConsultant").val(queryValues);
		layer.closeAll();
		var array = values.split(",");
		$("input[name='salesConsultantCB']").attr("checked",false);
		for (var i=0 ; i< array.length ; i++){
			$("input[name='salesConsultantCB']").each(function(){
				var value = $(this).val();
				if(value == array[i]){
					$(this).attr("checked",true);
				}
			});
		}
	}
	
	function changeUrlQuery(){
		url = httpUrlHead+"PotcusAchieveService/queryPotentialCustomerFollowList.json?"+httpUrlEnd;
		queryPt();
	}
	
	function queryPt(){
		_showQuery(1);
		_exe_query(url,"fm",true,true,false,"showDetail","showDetail","IS_SC","REPEAT_NUM_PAGE","CUS_SOURCE_DESC_PAGE","ALLOCATED_TIME");
	}
	
	function showDetail(id,tabType){
		_toPage("potcusDetail.html?id="+id+"&tabType="+tabType);
	}
	
	function dateTypeChange(val){
		if(val == ''){
			$("tr[name='dateTr']").hide()
			$("#startDate").val("");
			$("#endDate").val("");
		} else {
			$("tr[name='dateTr']").show()
			document.getElementById('startDate').value = new Date().getFullYear()+"-"+(new Date().getMonth()<9?"0":"")+(new Date().getMonth()+1)+"-"+(new Date().getDate()<10?"0":"")+new Date().getDate();
			document.getElementById('endDate').value = new Date().getFullYear()+"-"+(new Date().getMonth()<9?"0":"")+(new Date().getMonth()+1)+"-"+(new Date().getDate()<10?"0":"")+new Date().getDate();
		}
	}
	//车系车型配置颜色联动
function changeSMPCForLd(code) {
	var smpc = null;
	var defaultValue = null;
	smpc = document.getElementById("intentModel");
	defaultValue = $("#intentModel").attr("defaultValue");
	document.getElementById("intentModel").options.length=0;
	if (code == "") {
		return;
	}
	smpc.add(new Option("加载中...",""));
	var url = httpUrlHead+"PotcusAchieveService/querySMPC.json?code="+code+"&codeType=1&"+httpUrlEnd;
	makeFormCall(url, function(json){
		smpc.options.length=0;
		smpc.add(new Option("-请选择-",""));
		if(json.RESULT.funcStatus == "1") {
			var list = json.list;
			if(list != null && list.length > 0) {
				var selIndex = -1;
				for(var i = 0;i < list.length;i++) {
					smpc.add(new Option(list[i].GROUP_NAME,list[i].GROUP_CODE));
					if (defaultValue != undefined && defaultValue != null && defaultValue != "" && defaultValue == list[i].GROUP_CODE) {
						selIndex = i;
					}
				}
				if (selIndex >= 0) {
					smpc.options[selIndex+1].selected = true;						
				}
				$("#intentModel").attr("defaultValue","");
			}
		} else {
			MuiAlert("加载数据失败!");
		}
	}, "fm");
}
</script>
</html>


